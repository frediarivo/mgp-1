<odoo>

  <!-- explicit list view definition -->
  <record id="plainte_pmo_list_view" model="ir.ui.view">
    <field name="name">Plaintes.list</field>
    <field name="model">mgp.plainte</field>
    <field name="arch" type="xml">
      <tree>
        <field name="reference" string="Ticket" decoration-bf="id > 0"/>
        <field name="date_appel" />
        <field name="categorie_id" />
        <field name="zone" string="Localisation"/>
        <field name="genre" />
        <field name="jours_traitement" string="Nbr-jour(s)"/>
        <field name="statut" 
          decoration-warning="statut == 'state'" 
          decoration-info="statut == 'state_validate_prea'"
          decoration-primary="statut == 'state_traitement_pmo'"
          decoration-it="statut == 'state_eval_response_prea'"
          decoration-muted="statut == 'state_send_response_bpo'"
          decoration-success="statut == 'state_done_bpo'"
          decoration-danger="statut == 'state_invalid'"
          decoration-bf="id > 0"/>
      </tree>
    </field>
  </record>

  <!-- actions opening views on models -->
  <record id="plainte_pmo_form_view" model="ir.ui.view">
    <field name="name">plainte.pmo.form.view</field>
    <field name="model">mgp.plainte</field>
    <field name="arch" type="xml">
      <form>
        <field name="reponse_envoye" invisible="1"/> <!--IMPORTANT -->
        <field name="situation" invisible="1"/> <!--IMPORTANT -->
        <field name="resultat" invisible="1"/> <!--IMPORTANT -->
        <header>
          <!--Group receiver of current user ('is_last_group_receiver', '=', False) -->
          <field name="is_last_group_receiver" invisible="1" />

          <button name="action_send_response_to_prea" type="object" class="oe_highlight"
            string="Envoyer réponse au PREA" 
            confirm="Voulez vous envoyer la réponse au PREA?"
            statuts="state_traitement_pmo"
            attrs="{'invisible': [('statut', '!=', 'state_traitement_pmo')]}"/>

          <!-- Status bar -->
          <field name='statut' widget='statusbar' clickable="True" 
            statusbar_visible='state,state_validate_prea,state_traitement_pmo,state_eval_response_prea,state_send_response_bpo,state_done_bpo,state_invalid,state_closed_prea'/>
        </header>

        <sheet>
          <!-- Widget statinfo -->
          <div class="oe_button_box" name="button_box">
            <!-- Résultat -->
            <button name="get_result" type="object" class="oe_stat_button" icon="fa-thumbs-o-up text-success" style="width: 180px:"
              attrs="{'invisible': [('resultat', '!=', 'satisfait')]}">
              <field name="result_display" widget="statinfo"/>
            </button>

            <button name="get_result" type="object" class="oe_stat_button" icon="fa-thumbs-o-down text-warning" style="width: 180px:"
              attrs="{'invisible': [('resultat', '!=', 'insatisfait')]}">
              <field name="result_display" widget="statinfo"/>
            </button>

            <!-- Situation -->
            <button name="get_situation" type="object" class="oe_stat_button" icon="fa-phone text-success" style="width: 180px:"
              attrs="{'invisible': [('situation', '!=', 'joignable')]}">
              <field name="situation_display" widget="statinfo"/>
            </button>

            <button name="get_situation" type="object" class="oe_stat_button" icon="fa-phone text-warning" style="width: 180px:"
              attrs="{'invisible': [('situation', '!=', 'injoignable')]}">
              <field name="situation_display" widget="statinfo"/>
            </button>
            
            <!-- Nombre de jours de traitement -->
            <button name="get_jours_traitement" type="object" class="oe_stat_button" icon="fa-calendar text-warning" style="width: 180px:">
              <field name="jours_traitement" widget="statinfo"/>
            </button>

            <!-- Status de réponse -->
            <button name="check_response" type="object" class="oe_stat_button" icon="fa-inbox text-info" style="width: 180px:">
              <field name="statut_response_display" string="Reponse envoyée" widget="statinfo"/>
            </button>

            <!-- Status du ticket -->
            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-battery-quarter text-info"
              style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state')]}">
              <field name="statut_display" widget="statinfo" clickable="False"/>
            </button>

            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-battery-three-quarters text-info" 
                style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_validate_prea')]}">
              <field name="statut_display" widget="statinfo"/>
            </button>

            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-battery-three-quarters text-info" 
                style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_traitement_pmo')]}">
              <field name="statut_display" widget="statinfo"/>
            </button>

            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-battery-three-quarters text-info" 
                style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_eval_response_prea')]}">
              <field name="statut_display" widget="statinfo"/>
            </button>

            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-battery-three-quarters text-info" 
                style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_send_response_bpo')]}">
              <field name="statut_display" widget="statinfo"/>
            </button>

            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-battery-full text-success" 
              style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_done_bpo')]}">
              <field name="statut_display" widget="statinfo"/>
            </button>

            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-window-close text-primary" 
              style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_closed_prea')]}">
              <field name="statut_display" widget="statinfo"/>
            </button>
            
            <button name="get_statut" type="object" class="oe_stat_button" icon="fa-ban text-danger" 
                style="width: 180px:" attrs="{'invisible': [('statut', '!=', 'state_invalid')]}">
                <field name="statut_display" widget="statinfo"/>
            </button>

            <!-- Group Receiver actuel-->
            <button name="get_actual_group_name" type="object" class="oe_stat_button" icon="fa-group text-danger" style="width: 180px:">
              <field name="actual_group_name" widget="statinfo"/>
            </button>
          </div>

          <!-- Title -->
          <div class="oe_title" position="before">
            <label for="reference" string="Ticket n°" />
            <h1><field name="reference"/></h1>
          </div>

          <!-- Fields -->
          <group>
            <group>
              <field name="date_appel" readonly="1" />
              <field name="genre" readonly="1" />
              <field name="education_id" readonly="1"
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
              <field name="tranche_id" readonly="1"
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
              <field name="categorie_id" readonly="1"
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
            </group>
            <group>
              <field name="region_id" readonly="1"
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" /> 
              <field name="district_id" readonly="1"
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
              <field name="commune_id" readonly="1" 
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
              <field name="fokontany_id" readonly="1" 
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
              <field name="composante_id" readonly="1"
                options="{'no_create_edit': True, 'no_create': True, 'no_open': True}" />
            </group>
          </group>

          <group>  
            <field name="ennonce" string="Description" readonly="1" />
          </group>

          <notebook>
            <page name="Notes" string="Notes">
              <field name="note_ids" context="{'default_plainte_id':active_id}" widget="one2many_list" 
                attrs="{'readonly':[('statut', 'in', ['state','state_invalid','state_closed_prea'])]}">
                <tree editable="bottom">
                  <field name="plainte_id" invisible="1"/>
                  <field name="note" string="Notes"/>
                </tree>
              </field>
            </page>
            <page name="Responses" string="Réponse" autofocus="autofocus">
              <group>
                <field name="response_completed" attrs="{'readonly': [('response_completed', '=', True)]}"/>
              </group>
              <field name="reponse_ids" context="{'default_plainte_id':active_id}" widget="one2many_list">
                <tree editable="bottom">
                  <field name="plainte_id" invisible="1"/>
                  <field name="reponse"/>
                </tree>
              </field>
            </page>
          </notebook>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" widget="mail_followers"/>
          <field name="activity_ids" widget="mail_activity"/>
          <field name="message_ids" widget="mail_thread"/>
        </div>
      </form>
    </field>
  </record>

  <!-- View kanban -->
  <record id="plainte_pmo_kanban_view" model="ir.ui.view">
    <field name="name">plainte.pmo.kanban.view</field>
    <field name="model">mgp.plainte</field>
    <field name="arch" type="xml">
      <kanban default_group_by="statut" quick_create="false" class="o_kanban_small_column o_kanban_project_tasks">
        <field name="genre" />
        <field name="is_last_group_receiver" />
        <field name="reponse_envoye" />
        <field name="statut" />
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click">
              <t t-if="record.genre.raw_value=='masculin'">
                <img class="o_kanban_image" alt="profile_female" t-att-src='_s + "/mgp/static/src/img/profile_male.png"' width="24"/>  
              </t>
              <t t-else="">
                <img class="o_kanban_image" alt="profile_male" t-att-src='_s + "/mgp/static/src/img/profile_female.png"' width="24"/>
              </t>
              <div class="oe_kanban_details">
                <div class="o_kanban_tags_section" />
                <strong><field name="reference" /></strong>
                <ul>
                  <li><span class="mgp_label">Appel:</span>&#160;<field name="date_appel"/></li>
                  <li><span class="mgp_label">Zone:</span>&#160;<field name="zone"/></li>
                  <li><span class="mgp_label">Catégorie:</span>&#160;<field name="categorie_id"/></li>
                  <li attrs="{'invisible': [('reponse_envoye', '=', False)]}">
                    <span class="mgp_label">Réponse:</span>&#160;<strong><field name="reponse_envoye"/></strong>
                  </li>
                </ul>
              </div>
            </div>
            <br/><br/>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <!-- View Calendar -->
  <record id="plainte_pmo_calendar_view" model="ir.ui.view">
    <field name="name">plainte.calendar.view</field>
    <field name="model">mgp.plainte</field>
    <field name="arch" type="xml">
      <calendar string="Tickets" date_start="date_appel" mode="month" color="commune_id" quick_add="False"> 
        <field name="reference"/>
        <field name="categorie_id" options="{'no_open': True, 'no_create': True}"/>
        <field name="statut" class="text-warning"/>
        <field name="jours_traitement"/>
        <field name="reponse_envoye"/>
      </calendar>
    </field>
  </record>

  <!-- server action to the one above -->
  <record model="ir.actions.act_window" id="plainte_pmo_action_window">
    <field name="name">Traitement des plaintes</field>
    <field name="res_model">mgp.plainte</field>
    <field name="view_mode">kanban,tree,calendar,form</field>
    <field name="domain">[('user_pmo_id', '=', uid)]</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Aucun ticket (plainte)
      </p><p>
        Une plainte pourrait être émise par tout opérateur acteur lié directement 
        ou indirectement dans la mise en œuvre du projet, en particulier par un citoyen.
      </p>
    </field>
  </record>

  <!-- My Specific kanban: plainte_pmo_kanban_view -->
  <record model="ir.actions.act_window.view" id="pmo_action_window_kanban">
    <field eval="1" name="sequence"/>
    <field name="view_mode">kanban</field>
    <field name="view_id" ref="plainte_pmo_kanban_view"/>
    <field name="act_window_id" ref="plainte_pmo_action_window"/>
  </record>

  <!-- My Specific Tree: plainte_pmo_list_view -->
  <record model="ir.actions.act_window.view" id="pmo_action_window_tree">
    <field eval="2" name="sequence"/>
    <field name="view_mode">tree</field>
    <field name="view_id" ref="plainte_pmo_list_view"/>
    <field name="act_window_id" ref="plainte_pmo_action_window"/>
  </record>

  <!-- My Specific Calendar: plainte_pmo_list_view -->
  <record model="ir.actions.act_window.view" id="pmo_action_window_calendar">
    <field eval="3" name="sequence"/>
    <field name="view_mode">calendar</field>
    <field name="view_id" ref="plainte_pmo_calendar_view"/>
    <field name="act_window_id" ref="plainte_pmo_action_window"/>
  </record>

  <!-- My Specific Tree: plainte_pmo_form_view -->
  <record model="ir.actions.act_window.view" id="pmo_action_window_form">
    <field eval="4" name="sequence"/>
    <field name="view_mode">form</field>
    <field name="view_id" ref="plainte_pmo_form_view"/>
    <field name="act_window_id" ref="plainte_pmo_action_window"/>
  </record>

</odoo>